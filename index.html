<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eternal Empire - High Command Archive</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&family=Space+Mono&display=swap" rel="stylesheet">
<!-- FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>*{margin:0;padding:0;box-sizing:border-box}:root{--imperial-black:#0a0a0f;--imperial-dark:#121218;--imperial-gold:#d4af37;--imperial-amber:#ffb627;--imperial-blue:#4a9eff;--imperial-silver:#c0c0c0;--imperial-steel:#8a8a8a;--text-primary:#e8e8f0;--text-secondary:#a0a0b8;--color-leadership:#d4af37;--color-military:#ff5555;--color-administrative:#a78bfa;--color-trophy:#ff8c00;--color-alert:#fff;--current-primary:var(--imperial-gold);--current-secondary:var(--imperial-amber)}

/* CUSTOM SCROLLBAR */
::-webkit-scrollbar{width:12px;height:12px}
::-webkit-scrollbar-track{background:rgba(10,10,15,.8);border-radius:10px}
::-webkit-scrollbar-thumb{background:linear-gradient(180deg,var(--current-primary),rgba(var(--current-primary-rgb),.5));border-radius:10px;border:2px solid rgba(10,10,15,.8);box-shadow:0 0 10px var(--current-primary)}
::-webkit-scrollbar-thumb:hover{background:var(--current-primary);box-shadow:0 0 20px var(--current-primary)}
*{scrollbar-width:thin;scrollbar-color:var(--current-primary) rgba(10,10,15,.8)}

body{font-family:Rajdhani,sans-serif;background:var(--imperial-black);color:var(--text-primary);overflow-x:hidden;position:relative}

/* PARTICLE EFFECTS */
.background-layer{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none}
.stars{background:radial-gradient(2px 2px at 20% 30%,white,transparent),radial-gradient(2px 2px at 60% 70%,white,transparent);background-size:200% 200%;opacity:.3;animation:starsMove 120s linear infinite}
@keyframes starsMove{0%{background-position:0 0}100%{background-position:100% 100%}}
.grid-overlay{background:linear-gradient(90deg,rgba(212,175,55,.03) 1px,transparent 1px),linear-gradient(rgba(212,175,55,.03) 1px,transparent 1px);background-size:50px 50px;opacity:.4}
.scanline{position:absolute;width:100%;height:2px;background:linear-gradient(90deg,transparent,var(--imperial-gold),transparent);opacity:.2;animation:scan 8s linear infinite}
@keyframes scan{0%,100%{top:0}50%{top:100%}}

/* PARTICLES CANVAS */
#particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;opacity:.6}

.container{position:relative;z-index:1;max-width:1400px;margin:0 auto;padding:40px 20px 120px}

/* FACTION TRANSITION OVERLAY */
.faction-transition{position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle,var(--current-primary),transparent);opacity:0;z-index:9999;pointer-events:none;transition:opacity .5s}
.faction-transition.active{opacity:.3;animation:warpPulse .5s ease-out}
@keyframes warpPulse{0%{transform:scale(0);opacity:0}50%{opacity:.5}100%{transform:scale(3);opacity:0}}

.archive-header{text-align:center;margin-bottom:40px;padding:60px 20px 20px;position:relative}
.archive-header::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:300px;height:3px;background:linear-gradient(90deg,transparent,var(--current-primary),transparent);box-shadow:0 0 20px var(--current-primary);transition:all .5s}
.archive-title{font-family:Orbitron,sans-serif;font-size:4rem;font-weight:900;background:linear-gradient(135deg,var(--current-primary) 0%,var(--current-secondary) 50%,var(--current-primary) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:8px;margin-bottom:20px;text-transform:uppercase;animation:titleGlow 3s ease-in-out infinite alternate;transition:all .5s}
@keyframes titleGlow{from{filter:drop-shadow(0 0 10px rgba(212,175,55,.5))}to{filter:drop-shadow(0 0 30px rgba(212,175,55,.8))}}
.archive-subtitle{font-size:1.3rem;color:var(--text-secondary);letter-spacing:4px;text-transform:uppercase}

.faction-selector{display:flex;gap:20px;justify-content:center;margin-bottom:40px;perspective:1000px}
.faction-btn{font-family:Orbitron,sans-serif;padding:15px 40px;background:rgba(18,18,24,.8);border:2px solid rgba(212,175,55,.3);color:var(--text-secondary);border-radius:8px;cursor:pointer;font-weight:700;letter-spacing:3px;text-transform:uppercase;transition:all .3s;font-size:1rem;position:relative}
.faction-btn.empire{border-color:var(--imperial-gold)}
.faction-btn.fleet{border-color:var(--imperial-silver)}
.faction-btn.empire.active{background:linear-gradient(135deg,rgba(212,175,55,.25),rgba(212,175,55,.15));border-color:var(--imperial-gold);color:var(--imperial-gold);box-shadow:0 0 25px rgba(212,175,55,.4)}
.faction-btn.fleet.active{background:linear-gradient(135deg,rgba(192,192,192,.25),rgba(192,192,192,.15));border-color:var(--imperial-silver);color:var(--imperial-silver);box-shadow:0 0 25px rgba(192,192,192,.4)}
.faction-btn:hover{transform:translateY(-2px)}

.nav-tabs{display:flex;gap:20px;justify-content:center;margin-bottom:40px;flex-wrap:wrap}
.nav-tab{font-family:Orbitron,sans-serif;padding:12px 30px;background:rgba(18,18,24,.6);border:2px solid;border-color:var(--current-primary);color:var(--text-secondary);border-radius:8px;cursor:pointer;font-weight:700;letter-spacing:2px;text-transform:uppercase;transition:all .3s;font-size:.9rem;opacity:.6}
.nav-tab.active,.nav-tab:hover{background:linear-gradient(135deg,rgba(var(--current-primary-rgb),.2),rgba(var(--current-primary-rgb),.1));border-color:var(--current-primary);color:var(--current-primary);box-shadow:0 0 20px var(--current-primary);opacity:1}
.tab-content{display:none}
.tab-content.active{display:block}

.era-section{margin-bottom:50px}
.era-header{font-family:Orbitron,sans-serif;font-size:1.8rem;color:var(--current-primary);text-transform:uppercase;letter-spacing:4px;margin-bottom:30px;padding:20px;background:linear-gradient(135deg,rgba(var(--current-primary-rgb),.15),rgba(var(--current-primary-rgb),.05));border-left:4px solid var(--current-primary);border-radius:8px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
.era-title{flex:1;min-width:200px}
.era-edit-btns{display:none;gap:10px}
.edit-mode .era-edit-btns{display:flex}
.era-btn{padding:8px 16px;background:rgba(var(--current-primary-rgb),.2);border:2px solid var(--current-primary);color:var(--current-primary);border-radius:6px;cursor:pointer;font-family:Orbitron,sans-serif;font-size:.75rem;transition:all .3s}
.era-btn:hover{background:var(--current-primary);color:var(--imperial-black)}
.era-btn.delete{background:rgba(220,38,38,.2);border-color:#ff5555;color:#ff5555}
.era-btn.delete:hover{background:#ff5555;color:var(--imperial-black)}
.add-era-btn{display:none;margin:30px auto;padding:15px 40px;background:linear-gradient(135deg,rgba(74,158,255,.2),rgba(74,158,255,.1));border:2px solid var(--imperial-blue);color:var(--imperial-blue);border-radius:8px;cursor:pointer;font-family:Orbitron,sans-serif;font-weight:700;letter-spacing:2px;transition:all .3s}
.edit-mode .add-era-btn{display:block}
.add-era-btn:hover{background:var(--imperial-blue);color:var(--imperial-black)}

.members-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px;margin-bottom:40px}

/* ENHANCED MEMBER CARDS */
.member-card{background:linear-gradient(135deg,rgba(18,18,24,.9),rgba(18,18,24,.7));border:1px solid;border-color:var(--current-primary);opacity:.6;border-radius:12px;padding:25px;position:relative;overflow:hidden;transition:all .4s cubic-bezier(.4,0,.2,1);cursor:pointer;animation:cardEnter .6s ease-out backwards}

/* CORNER DECORATIONS */
.member-card::after{content:'';position:absolute;top:0;right:0;width:40px;height:40px;background:linear-gradient(135deg,transparent 50%,var(--current-primary) 50%);opacity:.2;clip-path:polygon(0 0,100% 0,100% 100%)}
.member-card::before{content:'';position:absolute;bottom:0;left:0;width:40px;height:40px;background:linear-gradient(-45deg,transparent 50%,var(--current-primary) 50%);opacity:.2;clip-path:polygon(0 0,0 100%,100% 100%)}

/* ANIMATED BORDER TRACE */
.member-card{border-image:linear-gradient(var(--angle,0deg),var(--current-primary),transparent,transparent,transparent,var(--current-primary)) 1;animation:borderRotate 6s linear infinite,cardEnter .6s ease-out backwards}
@keyframes borderRotate{0%{--angle:0deg}100%{--angle:360deg}}

.member-card.retired{opacity:.5}
@keyframes cardEnter{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

.member-card:hover{transform:translateY(-5px) scale(1.02);border-color:var(--current-primary);box-shadow:0 0 30px var(--current-primary),0 10px 40px rgba(0,0,0,.5),inset 0 0 20px rgba(var(--current-primary-rgb),.1);opacity:1}

.member-rank{display:inline-block;font-family:Orbitron,sans-serif;font-size:.7rem;font-weight:700;color:var(--current-primary);background:rgba(var(--current-primary-rgb),.15);padding:5px 12px;border-radius:20px;border:1px solid var(--current-primary);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;transition:all .3s;box-shadow:0 0 10px var(--current-primary)}
.member-name{font-family:Orbitron,sans-serif;font-size:1.5rem;font-weight:700;color:var(--text-primary);margin-bottom:10px;letter-spacing:2px;transition:all .3s}
.member-card:hover .member-name{color:var(--current-primary);text-shadow:0 0 20px var(--current-primary);transform:translateX(5px)}
.member-title{font-size:.95rem;color:var(--current-secondary);margin-bottom:10px;letter-spacing:1px}

/* BETTER IMAGE EFFECTS */
.image-container{position:relative;width:100%;margin-bottom:15px;overflow:hidden;border-radius:8px}
.member-image-small{width:100%;height:150px;object-fit:cover;border-radius:8px;border:1px solid var(--current-primary);transition:all .5s;filter:brightness(.9) contrast(1.1)}

/* CHROMATIC ABERRATION & HEXAGONAL FRAME */
.member-card:hover .member-image-small{filter:brightness(1) contrast(1.2);transform:scale(1.05);box-shadow:0 0 20px var(--current-primary),-2px 0 0 rgba(255,0,0,.3),2px 0 0 rgba(0,255,255,.3)}

/* HOLOGRAPHIC SCANLINES ON IMAGE */
.image-container::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(var(--current-primary-rgb),.05) 2px,rgba(var(--current-primary-rgb),.05) 4px);pointer-events:none;animation:scanlineMove 3s linear infinite}
@keyframes scanlineMove{0%{transform:translateY(0)}100%{transform:translateY(10px)}}

.member-card.retired .member-image-small{filter:brightness(.4) grayscale(.5)}
.image-placeholder-small{width:100%;height:150px;background:linear-gradient(135deg,rgba(var(--current-primary-rgb),.1),rgba(74,158,255,.1));border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);font-family:Orbitron,sans-serif;letter-spacing:2px;border:1px solid var(--current-primary);font-size:.8rem}
.retired-badge-small{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:Orbitron,sans-serif;font-size:1.5rem;font-weight:900;color:var(--current-primary);text-shadow:0 0 10px var(--current-primary),0 0 20px var(--current-primary);letter-spacing:4px;z-index:10;animation:retiredGlow 2s ease-in-out infinite alternate;pointer-events:none}
@keyframes retiredGlow{from{text-shadow:0 0 10px var(--current-primary),0 0 20px var(--current-primary)}to{text-shadow:0 0 20px var(--current-primary),0 0 30px var(--current-primary)}}

/* CHAMPION TITLES - SPECIAL STYLING */
.champion-badge{position:absolute;top:10px;left:10px;padding:6px 12px;background:linear-gradient(135deg,rgba(255,215,0,.3),rgba(255,165,0,.3));border:2px solid #ffd700;border-radius:6px;font-family:Orbitron,sans-serif;font-size:.65rem;font-weight:900;color:#ffd700;text-transform:uppercase;letter-spacing:1px;text-shadow:0 0 10px #ffd700;box-shadow:0 0 15px rgba(255,215,0,.5),inset 0 0 10px rgba(255,215,0,.2);animation:championPulse 2s ease-in-out infinite;z-index:15}
@keyframes championPulse{0%,100%{box-shadow:0 0 15px rgba(255,215,0,.5),inset 0 0 10px rgba(255,215,0,.2)}50%{box-shadow:0 0 25px rgba(255,215,0,.8),inset 0 0 15px rgba(255,215,0,.4)}}

.era-select,.faction-select{display:none;margin-bottom:10px}
.edit-mode .era-select,.edit-mode .faction-select{display:block}
.era-select select,.faction-select select{width:100%;padding:8px;background:rgba(0,0,0,.5);border:2px solid var(--current-primary);border-radius:6px;color:var(--text-primary);font-family:Rajdhani,sans-serif;cursor:pointer}

.audio-log-section{display:none;margin-top:15px;padding:15px;background:rgba(0,0,0,.3);border:1px solid var(--current-primary);border-radius:8px}
.edit-mode .audio-log-section{display:block}
.add-audio-btn{display:flex;align-items:center;gap:10px;padding:10px 20px;background:linear-gradient(135deg,rgba(var(--current-primary-rgb),.3),rgba(var(--current-primary-rgb),.2));border:2px solid var(--current-primary);border-radius:6px;color:var(--current-primary);font-family:Orbitron,sans-serif;font-size:.85rem;font-weight:700;cursor:pointer;transition:all .3s;text-transform:uppercase;letter-spacing:1px;width:100%;justify-content:center;border:none}
.add-audio-btn:hover{background:var(--current-primary);color:var(--imperial-black);box-shadow:0 0 20px var(--current-primary);transform:translateY(-2px)}
.add-audio-btn::before{content:'üîä';font-size:1.2rem}
.audio-player-wrapper{margin-top:10px;padding:10px;background:rgba(var(--current-primary-rgb),.1);border-radius:6px}
.audio-player-wrapper audio{width:100%;border-radius:6px;outline:none}
.delete-audio-btn{margin-top:10px;padding:6px 12px;background:rgba(220,38,38,.2);border:2px solid #ff5555;color:#ff5555;border-radius:4px;cursor:pointer;font-family:Orbitron,sans-serif;font-size:.7rem;transition:all .3s;border:none;width:100%}
.delete-audio-btn:hover{background:#ff5555;color:var(--imperial-black)}

/* ROLE MANAGEMENT SECTION */
.roles-section{display:none;margin-top:15px;padding:15px;background:rgba(0,0,0,.3);border:1px solid var(--current-primary);border-radius:8px}
.edit-mode .roles-section{display:block}
.roles-list{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px;min-height:40px;padding:10px;background:rgba(0,0,0,.3);border-radius:6px}
.role-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:6px;font-size:.8rem;font-weight:700;border:2px solid;cursor:pointer;transition:all .3s}
.role-badge:hover{transform:translateY(-2px);box-shadow:0 0 15px currentColor}
.role-remove{cursor:pointer;font-weight:900;opacity:.7}
.role-remove:hover{opacity:1;transform:scale(1.2)}
.add-role-btn{padding:8px 16px;background:rgba(var(--current-primary-rgb),.2);border:2px solid var(--current-primary);color:var(--current-primary);border-radius:6px;cursor:pointer;font-family:Orbitron,sans-serif;font-size:.75rem;transition:all .3s;width:100%}
.add-role-btn:hover{background:var(--current-primary);color:var(--imperial-black)}

.detail-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:2000;align-items:center;justify-content:center;animation:fadeIn .3s ease-out}
.detail-modal.active{display:flex}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.detail-content{background:linear-gradient(135deg,var(--imperial-dark),rgba(18,18,24,.98));border:2px solid var(--current-primary);border-radius:12px;width:90%;max-width:1200px;max-height:85vh;overflow:hidden;box-shadow:0 0 60px var(--current-primary);animation:slideIn .4s ease-out;display:flex;position:relative}
@keyframes slideIn{from{opacity:0;transform:translateY(-50px)}to{opacity:1;transform:translateY(0)}}
.detail-left{flex:1;padding:40px;border-right:1px solid var(--current-primary);overflow-y:auto;max-height:85vh}
.detail-right{flex:1;padding:40px;overflow-y:auto;max-height:85vh;background:rgba(0,0,0,.3)}
.detail-close{position:absolute;top:15px;right:15px;width:40px;height:40px;background:rgba(220,38,38,.2);border:2px solid #ff5555;border-radius:50%;color:#ff5555;font-size:1.5rem;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;z-index:10}
.detail-close:hover{background:#ff5555;color:var(--imperial-black);transform:rotate(90deg)}
.detail-image{width:100%;height:300px;object-fit:cover;border-radius:8px;border:2px solid var(--current-primary);margin-bottom:25px;box-shadow:0 0 30px var(--current-primary)}
.detail-image-placeholder{width:100%;height:300px;background:linear-gradient(135deg,rgba(var(--current-primary-rgb),.15),rgba(74,158,255,.15));border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);font-family:Orbitron,sans-serif;letter-spacing:3px;border:2px solid var(--current-primary);margin-bottom:25px;font-size:1.2rem}
.retired .detail-image,.retired .detail-image-placeholder{filter:brightness(.4);position:relative}
.retired-badge-detail{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:Orbitron,sans-serif;font-size:3rem;font-weight:900;color:var(--current-primary);text-shadow:0 0 20px var(--current-primary),0 0 30px var(--current-primary);letter-spacing:10px;z-index:10;animation:retiredGlow 2s ease-in-out infinite alternate}
.detail-rank{display:inline-block;font-family:Orbitron,sans-serif;font-size:.85rem;font-weight:700;color:var(--current-primary);background:rgba(var(--current-primary-rgb),.2);padding:8px 18px;border-radius:25px;border:2px solid var(--current-primary);letter-spacing:3px;text-transform:uppercase;margin-bottom:20px;box-shadow:0 0 15px var(--current-primary)}
.detail-name{font-family:Orbitron,sans-serif;font-size:2.5rem;font-weight:900;color:var(--current-primary);margin-bottom:15px;letter-spacing:4px;text-shadow:0 0 20px var(--current-primary)}
.detail-title{font-size:1.3rem;color:var(--current-secondary);margin-bottom:15px;letter-spacing:2px}
.detail-tenure{font-size:1.1rem;color:var(--text-secondary);margin-bottom:30px;font-style:italic}

.detail-roles-section{margin-top:30px}
.detail-section-header{font-family:Orbitron,sans-serif;font-size:1rem;color:var(--current-primary);text-transform:uppercase;letter-spacing:3px;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid var(--current-primary)}
.detail-roles-list{display:flex;flex-wrap:wrap;gap:10px}
.detail-role-badge{font-size:.9rem;padding:8px 15px;border-radius:6px;transition:all .3s;position:relative;border:2px solid}

/* CHAMPION TITLES IN DETAIL VIEW */
.detail-role-badge.champion{background:linear-gradient(135deg,rgba(255,215,0,.3),rgba(255,165,0,.2));border:2px solid #ffd700;color:#ffd700;font-weight:900;text-shadow:0 0 10px #ffd700;box-shadow:0 0 20px rgba(255,215,0,.5);animation:championShine 3s ease-in-out infinite}
@keyframes championShine{0%,100%{box-shadow:0 0 20px rgba(255,215,0,.5)}50%{box-shadow:0 0 30px rgba(255,215,0,.8),0 0 40px rgba(255,215,0,.3)}}

.detail-audio-section{margin-top:30px;padding:20px;background:rgba(0,0,0,.3);border:2px solid var(--current-primary);border-radius:8px}
.detail-audio-header{font-family:Orbitron,sans-serif;font-size:1rem;color:var(--current-primary);text-transform:uppercase;letter-spacing:3px;margin-bottom:15px;display:flex;align-items:center;gap:10px}
.detail-audio-header::before{content:'üîä';font-size:1.3rem}
.play-audio-btn{display:flex;align-items:center;gap:10px;padding:12px 25px;background:linear-gradient(135deg,rgba(var(--current-primary-rgb),.3),rgba(var(--current-primary-rgb),.2));border:2px solid var(--current-primary);border-radius:6px;color:var(--current-primary);font-family:Orbitron,sans-serif;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .3s;text-transform:uppercase;letter-spacing:1px;width:100%;justify-content:center;border:none}
.play-audio-btn:hover{background:var(--current-primary);color:var(--imperial-black);box-shadow:0 0 25px var(--current-primary);transform:translateY(-2px)}
.play-audio-btn::before{content:'‚ñ∂';font-size:1.1rem}
.play-audio-btn.playing::before{content:'‚èπ'}
.audio-player-container{margin-top:15px;padding:15px;background:rgba(var(--current-primary-rgb),.1);border-radius:6px;display:none}
.audio-player-container.active{display:block}
.audio-player-container audio{width:100%;outline:none;border-radius:6px}

.bio-header{font-family:Orbitron,sans-serif;font-size:2rem;color:var(--current-primary);text-transform:uppercase;letter-spacing:6px;margin-bottom:30px;text-align:center;border-bottom:2px solid var(--current-primary);padding-bottom:15px}
.bio-text{font-family:'Space Mono',monospace;font-size:1.05rem;line-height:1.8;color:var(--text-primary);white-space:pre-wrap}
.bio-text::after{content:'‚ñÆ';animation:blink 1s infinite;margin-left:2px}
@keyframes blink{0%,49%{opacity:1}50%,100%{opacity:0}}

/* GLOWING CONNECTION LINES IN HIERARCHY */
.org-chart{padding:40px 20px;overflow-x:auto}
.chart-container{min-width:800px;display:flex;flex-direction:column;align-items:center;gap:40px}
.chart-level{display:flex;justify-content:center;gap:30px;flex-wrap:wrap;position:relative}
.chart-node{background:linear-gradient(135deg,rgba(18,18,24,.95),rgba(18,18,24,.85));border:2px solid var(--current-primary);border-radius:10px;padding:20px;min-width:200px;text-align:center;position:relative;cursor:pointer;transition:all .3s;box-shadow:0 0 20px var(--current-primary)}
.chart-node:hover{transform:translateY(-5px);box-shadow:0 0 40px var(--current-primary);border-color:var(--current-secondary)}
.chart-node.emperor,.chart-node.fleet-commander{border-width:3px;box-shadow:0 0 30px var(--current-primary)}
.chart-rank-badge{font-family:Orbitron,sans-serif;font-size:.7rem;color:var(--current-primary);background:rgba(var(--current-primary-rgb),.15);padding:4px 10px;border-radius:15px;border:1px solid var(--current-primary);margin-bottom:10px;display:inline-block}
.chart-name{font-family:Orbitron,sans-serif;font-size:1.1rem;font-weight:700;color:var(--text-primary);margin-bottom:5px}
.chart-title{font-size:.85rem;color:var(--current-secondary)}

/* ANIMATED GLOWING CONNECTION LINES */
.chart-line{position:absolute;width:3px;background:linear-gradient(180deg,var(--current-primary),transparent);height:40px;top:-40px;left:50%;transform:translateX(-50%);box-shadow:0 0 10px var(--current-primary);animation:energyFlow 2s ease-in-out infinite}
@keyframes energyFlow{0%,100%{box-shadow:0 0 10px var(--current-primary),0 0 20px var(--current-primary)}50%{box-shadow:0 0 20px var(--current-primary),0 0 30px var(--current-primary),0 0 40px var(--current-primary)}}

/* ENERGY PULSE DOTS */
.chart-line::after{content:'';position:absolute;width:8px;height:8px;background:var(--current-primary);border-radius:50%;left:50%;transform:translateX(-50%);top:0;box-shadow:0 0 15px var(--current-primary);animation:pulseMove 2s linear infinite}
@keyframes pulseMove{0%{top:0;opacity:1}100%{top:100%;opacity:0}}

.hierarchy-edit-controls{display:none;margin:20px 0;text-align:center;gap:15px;justify-content:center;flex-wrap:wrap}
.edit-mode .hierarchy-edit-controls{display:flex}
.hierarchy-btn{padding:10px 25px;background:rgba(var(--current-primary-rgb),.2);border:2px solid var(--current-primary);color:var(--current-primary);border-radius:6px;cursor:pointer;font-family:Orbitron,sans-serif;font-size:.8rem;transition:all .3s}
.hierarchy-btn:hover{background:var(--current-primary);color:var(--imperial-black)}

.timeline-container{padding:40px 20px}
.timeline{position:relative;padding:40px 0}
.timeline::before{content:'';position:absolute;left:50%;top:0;bottom:0;width:3px;background:linear-gradient(180deg,var(--current-primary),rgba(var(--current-primary-rgb),.3));box-shadow:0 0 10px var(--current-primary)}
.timeline-item{position:relative;margin-bottom:60px;display:flex;justify-content:center}
.timeline-content{background:linear-gradient(135deg,rgba(18,18,24,.95),rgba(18,18,24,.85));border:2px solid var(--current-primary);border-radius:10px;padding:25px;width:45%;position:relative;box-shadow:0 0 20px var(--current-primary);cursor:pointer;transition:all .3s}
.timeline-content:hover{transform:translateX(-10px);box-shadow:0 0 40px var(--current-primary)}
.timeline-item:nth-child(even) .timeline-content{margin-left:auto}
.timeline-item:nth-child(even) .timeline-content:hover{transform:translateX(10px)}
.timeline-dot{position:absolute;left:50%;top:20px;transform:translateX(-50%);width:20px;height:20px;background:var(--current-primary);border:4px solid var(--imperial-dark);border-radius:50%;box-shadow:0 0 20px var(--current-primary);z-index:10}
.timeline-date{font-family:Orbitron,sans-serif;font-size:.85rem;color:var(--current-primary);text-transform:uppercase;letter-spacing:2px;margin-bottom:10px}
.timeline-event-title{font-family:Orbitron,sans-serif;font-size:1.2rem;font-weight:700;color:var(--text-primary);margin-bottom:8px}
.timeline-event-desc{font-size:.95rem;color:var(--text-secondary);line-height:1.6}
.timeline-edit-btns{display:none;gap:10px;margin-top:15px}
.edit-mode .timeline-edit-btns{display:flex}
.timeline-btn{padding:6px 12px;background:rgba(var(--current-primary-rgb),.2);border:2px solid var(--current-primary);color:var(--current-primary);border-radius:6px;cursor:pointer;font-family:Orbitron,sans-serif;font-size:.7rem;transition:all .3s}
.timeline-btn:hover{background:var(--current-primary);color:var(--imperial-black)}
.timeline-btn.delete{background:rgba(220,38,38,.2);border-color:#ff5555;color:#ff5555}
.timeline-btn.delete:hover{background:#ff5555;color:var(--imperial-black)}
.add-timeline-btn{display:none;margin:30px auto;padding:15px 40px;background:linear-gradient(135deg,rgba(74,158,255,.2),rgba(74,158,255,.1));border:2px solid var(--imperial-blue);color:var(--imperial-blue);border-radius:8px;cursor:pointer;font-family:Orbitron,sans-serif;font-weight:700;letter-spacing:2px;transition:all .3s}
.edit-mode .add-timeline-btn{display:block}
.add-timeline-btn:hover{background:var(--imperial-blue);color:var(--imperial-black)}

.edit-controls{position:fixed;bottom:30px;right:30px;display:flex;gap:15px;z-index:50;flex-direction:column;align-items:flex-end}
.edit-btn,.save-btn,.add-member-btn,.settings-btn{font-family:Orbitron,sans-serif;padding:15px 30px;background:linear-gradient(135deg,var(--imperial-dark),rgba(18,18,24,.95));border:2px solid var(--current-primary);color:var(--current-primary);border-radius:8px;cursor:pointer;font-weight:700;letter-spacing:2px;text-transform:uppercase;transition:all .3s;box-shadow:0 0 20px var(--current-primary)}
.edit-btn:hover,.save-btn:hover,.add-member-btn:hover,.settings-btn:hover{background:var(--current-primary);color:var(--imperial-black);box-shadow:0 0 40px var(--current-primary);transform:translateY(-2px)}
.save-btn{background:linear-gradient(135deg,rgba(34,197,94,.2),rgba(34,197,94,.1));border-color:#4ade80;color:#4ade80}
.save-btn:hover{background:#4ade80;color:var(--imperial-black)}
.add-member-btn{background:linear-gradient(135deg,rgba(74,158,255,.2),rgba(74,158,255,.1));border-color:var(--imperial-blue);color:var(--imperial-blue)}
.add-member-btn:hover{background:var(--imperial-blue);color:var(--imperial-black)}
.edit-mode .member-card{border:2px dashed var(--current-primary)}
.editable-field{position:relative}
.edit-mode .editable-field:hover::after{content:'‚úé';position:absolute;right:-25px;top:50%;transform:translateY(-50%);color:var(--current-primary);font-size:1.2rem}
.image-upload-zone{display:none;margin-top:15px;padding:15px;border:2px dashed var(--current-primary);border-radius:8px;text-align:center;cursor:pointer;transition:all .3s;font-size:.85rem}
.edit-mode .image-upload-zone{display:block}
.image-upload-zone:hover{background:rgba(var(--current-primary-rgb),.1)}

.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:1000;align-items:center;justify-content:center}
.modal-overlay.active{display:flex}
.password-modal,.settings-modal,.edit-era-modal,.edit-timeline-modal,.edit-hierarchy-modal,.edit-role-modal{background:linear-gradient(135deg,var(--imperial-dark),rgba(18,18,24,.95));border:2px solid var(--current-primary);border-radius:12px;padding:40px;max-width:500px;width:90%;text-align:center;box-shadow:0 0 50px var(--current-primary);animation:modalEnter .3s ease-out;max-height:80vh;overflow-y:auto}
.settings-modal{max-width:700px}
@keyframes modalEnter{from{opacity:0;transform:translateY(-50px)}to{opacity:1;transform:translateY(0)}}
.password-modal h2,.settings-modal h2,.edit-era-modal h2,.edit-timeline-modal h2,.edit-hierarchy-modal h2,.edit-role-modal h2{font-family:Orbitron,sans-serif;color:var(--current-primary);margin-bottom:20px;letter-spacing:3px}
.password-modal input,.edit-era-modal input,.edit-timeline-modal input,.edit-timeline-modal textarea,.edit-hierarchy-modal input,.edit-hierarchy-modal select,.edit-role-modal input{width:100%;padding:15px;background:rgba(0,0,0,.5);border:2px solid var(--current-primary);border-radius:8px;color:var(--text-primary);font-family:Rajdhani,sans-serif;font-size:1.1rem;margin-bottom:15px}
.edit-timeline-modal textarea{min-height:100px;resize:vertical}
.modal-buttons{display:flex;gap:15px;justify-content:center;margin-top:20px}
.modal-btn{padding:12px 30px;background:var(--current-primary);border:none;border-radius:6px;color:var(--imperial-black);font-family:Orbitron,sans-serif;font-weight:700;cursor:pointer;transition:all .3s}
.modal-btn.cancel{background:rgba(255,255,255,.1);color:var(--text-primary)}
.error-message{color:#ff5555;margin-top:10px;font-size:.9rem;min-height:20px}
.color-settings{text-align:left;margin-bottom:20px}
.color-setting-item{margin-bottom:15px;display:flex;align-items:center;justify-content:space-between}
.color-setting-item input[type=color]{width:60px;height:40px;border:2px solid var(--current-primary);border-radius:6px;cursor:pointer}

/* ROLE LIST IN SETTINGS */
.role-list{margin-top:20px}
.role-item{display:flex;justify-content:space-between;align-items:center;padding:12px;background:rgba(var(--current-primary-rgb),.1);border:1px solid var(--current-primary);border-radius:6px;margin-bottom:10px}
.role-info{display:flex;align-items:center;gap:15px;flex:1}
.role-color-preview{width:30px;height:30px;border-radius:6px;border:2px solid var(--current-primary)}
.role-actions{display:flex;gap:8px}
.role-action-btn{padding:6px 12px;background:rgba(var(--current-primary-rgb),.2);border:2px solid var(--current-primary);color:var(--current-primary);border-radius:4px;cursor:pointer;font-size:.75rem;transition:all .3s}
.role-action-btn:hover{background:var(--current-primary);color:var(--imperial-black)}
.role-action-btn.delete{background:rgba(220,38,38,.2);border-color:#ff5555;color:#ff5555}
.role-action-btn.delete:hover{background:#ff5555;color:var(--imperial-black)}
.add-role-section-btn{width:100%;padding:12px;background:linear-gradient(135deg,rgba(74,158,255,.2),rgba(74,158,255,.1));border:2px solid var(--imperial-blue);color:var(--imperial-blue);border-radius:6px;cursor:pointer;font-family:Orbitron,sans-serif;font-weight:700;transition:all .3s;margin-top:15px}
.add-role-section-btn:hover{background:var(--imperial-blue);color:var(--imperial-black)}

.status-controls{display:none;margin-bottom:15px}
.edit-mode .status-controls{display:flex;gap:10px;align-items:center}
.status-controls select{padding:8px 15px;background:rgba(0,0,0,.5);border:2px solid var(--current-primary);border-radius:6px;color:var(--text-primary);cursor:pointer}
.delete-member-btn{display:none;position:absolute;top:10px;right:10px;padding:6px 12px;background:rgba(220,38,38,.2);border:2px solid #ff5555;border-radius:6px;color:#ff5555;font-family:Orbitron,sans-serif;font-size:.7rem;cursor:pointer;transition:all .3s;z-index:20}
.edit-mode .delete-member-btn{display:block}
.delete-member-btn:hover{background:#ff5555;color:var(--imperial-black)}
.tenure-inputs{display:none;gap:10px;margin-bottom:15px}
.edit-mode .tenure-inputs{display:flex}
.tenure-inputs input{flex:1;padding:8px;background:rgba(0,0,0,.5);border:2px solid var(--current-primary);border-radius:6px;color:var(--text-primary);font-size:.9rem}

/* LOADING ANIMATION */
.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--imperial-black);z-index:10000;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:30px;transition:opacity .5s}
.loading-overlay.hidden{opacity:0;pointer-events:none}
.loading-spinner{width:80px;height:80px;border:4px solid rgba(var(--current-primary-rgb),.2);border-top:4px solid var(--current-primary);border-radius:50%;animation:spin 1s linear infinite;box-shadow:0 0 30px var(--current-primary)}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.loading-text{font-family:Orbitron,sans-serif;font-size:1.2rem;color:var(--current-primary);letter-spacing:4px;text-transform:uppercase;animation:pulse 1.5s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:.5}50%{opacity:1}}

@media (max-width:768px){.archive-title{font-size:2.5rem;letter-spacing:4px}.members-grid{grid-template-columns:1fr}.detail-content{flex-direction:column}.detail-left,.detail-right{border:none;max-height:none}.timeline-content{width:90%}.timeline::before{left:20px}.timeline-dot{left:20px}.edit-controls{bottom:15px;right:15px;gap:10px}.edit-btn,.save-btn,.add-member-btn,.settings-btn{padding:10px 20px;font-size:.8rem}}
/* SYNC INDICATOR */
.sync-indicator{position:fixed;top:20px;right:20px;padding:10px 20px;background:rgba(18,18,24,.95);border:2px solid;border-radius:8px;font-family:Orbitron,sans-serif;font-size:.8rem;z-index:9999;display:flex;align-items:center;gap:10px;opacity:0;transition:opacity .3s;pointer-events:none}
.sync-indicator.visible{opacity:1}
.sync-indicator.syncing{border-color:#4a9eff;color:#4a9eff}
.sync-indicator.synced{border-color:#4ade80;color:#4ade80}
.sync-indicator.error{border-color:#ff5555;color:#ff5555}
.sync-indicator::before{content:'';width:10px;height:10px;border-radius:50%;background:currentColor;box-shadow:0 0 10px currentColor;animation:syncPulse 1.5s ease-in-out infinite}
@keyframes syncPulse{0%,100%{opacity:.5;transform:scale(1)}50%{opacity:1;transform:scale(1.2)}}

</style>
</head>
<body>
<!-- LOADING SCREEN -->
<div class="loading-overlay" id="loadingOverlay">
<div class="loading-spinner"></div>

<!-- SYNC INDICATOR -->
<div class="sync-indicator" id="syncIndicator">
<span id="syncText">Connecting...</span>
</div>

<div class="loading-text">Accessing Archives...</div>
</div>

<!-- FACTION TRANSITION EFFECT -->
<div class="faction-transition" id="factionTransition"></div>

<!-- PARTICLES CANVAS -->
<canvas id="particles"></canvas>

<div class="background-layer stars"></div>
<div class="background-layer grid-overlay"></div>
<div class="scanline"></div>
<div class="container">
<header class="archive-header">
<h1 class="archive-title" id="mainTitle">Eternal Empire</h1>
<p class="archive-subtitle">High Command Archive</p>
</header>

<div class="faction-selector">
<button class="faction-btn empire active" onclick="switchFaction('empire')">‚öîÔ∏è ETERNAL EMPIRE</button>
<button class="faction-btn fleet" onclick="switchFaction('fleet')">üöÄ ETERNAL FLEET</button>
</div>

<div class="nav-tabs">
<div class="nav-tab active" data-tab="archives">üìÅ Archives</div>
<div class="nav-tab" data-tab="hierarchy">üèõÔ∏è Hierarchy Chart</div>
<div class="nav-tab" data-tab="timeline">üìú Timeline</div>
</div>

<div class="tab-content active" id="archives">
<div id="erasContainer"></div>
<button class="add-era-btn" id="addEraBtn">‚ûï Add New Era</button>
</div>

<div class="tab-content" id="hierarchy">
<div class="org-chart">
<div class="hierarchy-edit-controls">
<button class="hierarchy-btn" id="addHierarchyBtn">‚ûï Add Position</button>
</div>
<div class="chart-container" id="chartContainer"></div>
</div>
</div>

<div class="tab-content" id="timeline">
<div class="timeline-container">
<div class="timeline" id="timelineContainer"></div>
<button class="add-timeline-btn" id="addTimelineBtn">‚ûï Add Timeline Event</button>
</div>
</div>

</div>

<div class="detail-modal" id="detailModal">
<div class="detail-content">
<div class="detail-close" id="detailClose">√ó</div>
<div class="detail-left" id="detailLeft"></div>
<div class="detail-right">
<div class="bio-header">BIOGRAPHY</div>
<div class="bio-text" id="bioText"></div>
</div>
</div>
</div>

<div class="edit-controls">
<button class="settings-btn" id="settingsBtn" style="display:none">‚öôÔ∏è Settings</button>
<button class="add-member-btn" id="addMemberBtn" style="display:none">‚ûï Add Archive</button>
<button class="save-btn" id="saveBtn" style="display:none">üíæ Save</button>
<button class="edit-btn" id="editBtn">üîì Edit Mode</button>
</div>

<div class="modal-overlay" id="passwordModal">
<div class="password-modal">
<h2>üîí SECURITY CLEARANCE REQUIRED</h2>
<p style="color:var(--text-secondary)">Enter authorization code</p>
<input type="password" id="passwordInput" placeholder="Enter Password">
<div class="error-message" id="errorMessage"></div>
<div class="modal-buttons">
<button class="modal-btn cancel" id="cancelBtn">Cancel</button>
<button class="modal-btn" id="submitBtn">Authorize</button>
</div>
</div>
</div>

<div class="modal-overlay" id="settingsModal">
<div class="settings-modal">
<h2>‚öôÔ∏è ARCHIVE SETTINGS</h2>

<h3 style="color:var(--current-primary);margin-bottom:15px;font-family:Orbitron,sans-serif;text-align:left">Roles Management</h3>
<div class="role-list" id="roleList"></div>
<button class="add-role-section-btn" id="addNewRoleBtn">‚ûï Create New Role</button>

<div class="modal-buttons" style="margin-top:30px">
<button class="modal-btn cancel" id="settingsCloseBtn">Close</button>
</div>
</div>
</div>

<div class="modal-overlay" id="editRoleModal">
<div class="edit-role-modal">
<h2 id="roleModalTitle">‚ûï CREATE NEW ROLE</h2>
<input type="text" id="roleNameInput" placeholder="Role Name (e.g., Prince, Champion of Zakuul)">
<input type="color" id="roleColorInput" value="#d4af37" style="width:100%;height:60px;cursor:pointer">
<div class="modal-buttons">
<button class="modal-btn cancel" id="roleModalCancel">Cancel</button>
<button class="modal-btn" id="roleModalSave">Save</button>
</div>
</div>
</div>

<div class="modal-overlay" id="editEraModal">
<div class="edit-era-modal">
<h2 id="eraModalTitle">‚ûï ADD NEW ERA</h2>
<input type="text" id="eraNameInput" placeholder="Era Name (e.g., 2024-2025 Era)">
<div class="modal-buttons">
<button class="modal-btn cancel" id="eraModalCancel">Cancel</button>
<button class="modal-btn" id="eraModalSave">Save</button>
</div>
</div>
</div>

<div class="modal-overlay" id="editTimelineModal">
<div class="edit-timeline-modal">
<h2 id="timelineModalTitle">‚ûï ADD TIMELINE EVENT</h2>
<input type="text" id="timelineDateInput" placeholder="Date (e.g., January 2024)">
<input type="text" id="timelineTitleInput" placeholder="Event Title">
<textarea id="timelineDescInput" placeholder="Event Description"></textarea>
<div class="modal-buttons">
<button class="modal-btn cancel" id="timelineModalCancel">Cancel</button>
<button class="modal-btn" id="timelineModalSave">Save</button>
</div>
</div>
</div>

<div class="modal-overlay" id="editHierarchyModal">
<div class="edit-hierarchy-modal">
<h2 id="hierarchyModalTitle">‚ûï ADD HIERARCHY POSITION</h2>
<select id="hierarchyLevel">
<option value="1">Top Level (Emperor/Commander)</option>
<option value="2">Second Level (Princes/Captains)</option>
<option value="3">Third Level (High Justice/Officers)</option>
</select>
<input type="text" id="hierarchyRank" placeholder="Rank (e.g., Prince)">
<input type="text" id="hierarchyName" placeholder="Name">
<input type="text" id="hierarchyTitle" placeholder="Title">
<div class="modal-buttons">
<button class="modal-btn cancel" id="hierarchyModalCancel">Cancel</button>
<button class="modal-btn" id="hierarchyModalSave">Save</button>
</div>
</div>
</div>

<div class="modal-overlay" id="assignRolesModal">
<div class="edit-role-modal">
<h2>üìã ASSIGN ROLES</h2>
<p style="color:var(--text-secondary);margin-bottom:20px">Select roles for <span id="assignMemberName" style="color:var(--current-primary)"></span></p>
<div id="availableRolesList" style="text-align:left;max-height:400px;overflow-y:auto"></div>
<div class="modal-buttons">
<button class="modal-btn cancel" id="assignRolesCancel">Cancel</button>
<button class="modal-btn" id="assignRolesSave">Save</button>
</div>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// ========================================
// FIREBASE CONFIGURATION
// ========================================
const firebaseConfig = {
  apiKey: "AIzaSyCsrNwKe5v3TLoMCTd8naw46pI_ddabH1Q",
  authDomain: "ethernalempire-a7601.firebaseapp.com",
  databaseURL: "https://ethernalempire-a7601-default-rtdb.firebaseio.com",
  projectId: "ethernalempire-a7601",
  storageBucket: "ethernalempire-a7601.firebasestorage.app",
  messagingSenderId: "124324351692",
  appId: "1:124324351692:web:a4a514fc0fa9c54cf0fc69"
};

// Initialize Firebase
let database, dataRef, isSyncing = false;

function showSync(text, status) {
  const indicator = document.getElementById('syncIndicator');
  const textEl = document.getElementById('syncText');
  if (indicator && textEl) {
    textEl.textContent = text;
    indicator.className = 'sync-indicator visible ' + status;
    setTimeout(function() {
      if (status === 'synced') indicator.classList.remove('visible');
    }, 2000);
  }
}

try {
  firebase.initializeApp(firebaseConfig);
  database = firebase.database();
  dataRef = database.ref('eternalArchive');
  console.log('‚úÖ Firebase connected!');
  showSync('Connected', 'synced');
} catch (error) {
  console.error('‚ùå Firebase error:', error);
  showSync('Offline Mode', 'error');
}

function saveToFirebase(dataToSave) {
  if (!database || isSyncing) return;
  isSyncing = true;
  showSync('Syncing...', 'syncing');
  dataRef.set(dataToSave)
    .then(function() {
      console.log('‚úÖ Synced to Firebase');
      showSync('Synced', 'synced');
      setTimeout(function() { isSyncing = false; }, 1000);
    })
    .catch(function(error) {
      console.error('‚ùå Sync failed:', error);
      showSync('Sync Failed', 'error');
      setTimeout(function() { isSyncing = false; }, 1000);
    });
}

function loadFromFirebase() {
  if (!database) return Promise.resolve(null);
  return dataRef.once('value')
    .then(function(snapshot) {
      return snapshot.val();
    })
    .catch(function(error) {
      console.error('‚ùå Load failed:', error);
      return null;
    });
}

function listenToChanges() {
  if (!database) return;
  dataRef.on('value', function(snapshot) {
    if (isSyncing) return;
    var newData = snapshot.val();
    if (newData) {
      isSyncing = true;
      data = newData;
      ensureDataStructure(data.empire);
      ensureDataStructure(data.fleet);
      renderEras();
      renderTimeline();
      renderHierarchy();
      showSync('Updated', 'synced');
      setTimeout(function() { isSyncing = false; }, 1000);
    }
  });
}

// ========================================
// YOUR CODE CONTINUES BELOW
// ========================================


// PARTICLE SYSTEM
const canvas=document.getElementById('particles');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let particles=[];
const particleCount=60;
let currentColor='rgba(212,175,55';

class Particle{
constructor(){
this.x=Math.random()*canvas.width;
this.y=Math.random()*canvas.height;
this.size=Math.random()*3+1;
this.speedX=(Math.random()-.5)*.5;
this.speedY=(Math.random()-.5)*.5;
this.opacity=Math.random()*.5+.2;
}
update(){
this.x+=this.speedX;
this.y+=this.speedY;
if(this.x>canvas.width)this.x=0;
if(this.x<0)this.x=canvas.width;
if(this.y>canvas.height)this.y=0;
if(this.y<0)this.y=canvas.height;
}
draw(){
ctx.fillStyle=`${currentColor},${this.opacity})`;
ctx.beginPath();
ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
ctx.fill();
ctx.shadowBlur=15;
ctx.shadowColor=`${currentColor},${this.opacity})`;
}
}

function initParticles(){
particles=[];
for(let i=0;i<particleCount;i++){
particles.push(new Particle());
}
}

function animateParticles(){
ctx.clearRect(0,0,canvas.width,canvas.height);
particles.forEach(particle=>{
particle.update();
particle.draw();
});
requestAnimationFrame(animateParticles);
}

window.addEventListener('resize',()=>{
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;
initParticles();
});

initParticles();
animateParticles();

// LOADING SCREEN
window.addEventListener('load',async function(){
const firebaseData = await loadFromFirebase();
if(firebaseData){
data = firebaseData;
console.log('‚úÖ Loaded from Firebase');
} else {
const savedData=localStorage.getItem('eternalArchiveData');
if(savedData){
try{
const loaded=JSON.parse(savedData);
if(loaded.empire){
ensureDataStructure(loaded.empire);
data.empire=loaded.empire;
}
if(loaded.fleet){
ensureDataStructure(loaded.fleet);
data.fleet=loaded.fleet;
}
console.log('‚úÖ Loaded from localStorage');
}catch(e){
console.error('Error loading data:',e);
}
}
}
ensureDataStructure(data.empire);
ensureDataStructure(data.fleet);
nextId=Math.max(...data.empire.members.map(m=>m.id),...data.fleet.members.map(m=>m.id))+1;
nextEraId=Math.max(...data.empire.eras.map(e=>e.id),...data.fleet.eras.map(e=>e.id))+1;
nextTimelineId=Math.max(...data.empire.timeline.map(e=>e.id),...data.fleet.timeline.map(e=>e.id))+1;
const allRoles=[...data.empire.roles,...data.fleet.roles];
nextRoleId=allRoles.length>0?Math.max(...allRoles.map(r=>r.id))+1:10;
renderEras();
switchFaction('empire');
listenToChanges();
});

renderEras();
</script>
</body>
</html>
